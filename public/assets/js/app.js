"use strict";$(document).ready(function(){$(window).resize(function(){$("main").css({"margin-top":$("header").height(),"margin-bottom":$("footer").height()})}).resize();var a=new Player("#song","#player");$(document).on("click",".play-song",function(){t($(this))});var t=function(t){a.pause();var e=parseInt(t.attr("rel")),i=[];$(".play-song").each(function(){parseInt($(this).attr("rel"))>=e&&i.push({type:$(this).data("type"),src:$(this).data("src"),title:$(this).data("title"),artist:$(this).data("artist"),album:$(this).data("album")})}),a.setType(t.data("type")).setSrc(t.data("src")).title(t.data("title")).artist(t.data("artist")).album(t.data("album")).play(!0,i)}}),Number.prototype.timeFormat=function(){var t=Math.ceil(this.valueOf()),e=t%60;return Math.floor(t/60)+":"+(e<10?"0"+e:e)};var _createClass=function(){function a(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,e,i){return e&&a(t.prototype,e),i&&a(t,i),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Player=function(){function a(t,e){_classCallCheck(this,a),this.audio=$(t),this.player=$(e),this.status="stopped",this.data={},this.queue=null,this.originalTitle=document.title;var i=this;this.audio.on("timeupdate",function(){var t=i.audio[0].currentTime,e=i.audio[0].duration;t&&e&&(t<e?(i.player.find(".progress-bar").css("width",t/e*100+"%"),i.player.find(".progress-time").html("<i>"+t.timeFormat()+"</i>/"+e.timeFormat())):i.next())}),this.player.find(".toggle-play").click(function(){"playing"!==i.status?i.play():i.pause()}),this.player.find(".play-prev").click(function(){2<i.audio[0].currentTime?i.restart():i.previous()}),this.player.find(".play-next").click(function(){i.next()}),this.player.find(".list-queue").click(function(){i.listQueue()})}return _createClass(a,[{key:"play",value:function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(this.audio.trigger("play"),t&&(this.player.find(".title").html(this.data.title),this.player.find(".artist").html(this.data.artist),this.player.find(".album").html(this.data.album),document.title=this.data.title+" - "+this.data.artist+" | chilii Music Player",e&&(this.queue=new Queue(e)),this.queue)){var i=this.player.find(".queue");i.hasClass("open")&&i.slideUp("fast",function(){i.removeClass("open")})}return this.player.find(".fa-play").removeClass("fa-play").addClass("fa-pause"),this.status="playing",this}},{key:"pause",value:function(){return this.audio.trigger("pause"),this.player.find(".fa-pause").removeClass("fa-pause").addClass("fa-play"),this.status="paused",this}},{key:"restart",value:function(){return this.audio[0].currentTime=0,this}},{key:"stop",value:function(){return this.pause().restart(),document.title=this.originalTitle,this}},{key:"previous",value:function(){if(this.previousHandler)this.previousHandler();else if(this.queue){var t=this.queue.previous();this.setType(t.type).setSrc(t.src).title(t.title).artist(t.artist).album(t.album).play(!0)}}},{key:"next",value:function(){if(this.nextHandler)this.nextHandler();else if(this.queue){var t=this.queue.next();this.setType(t.type).setSrc(t.src).title(t.title).artist(t.artist).album(t.album).play(!0)}}},{key:"title",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return t?(this.data.title=t,this):this.data.title}},{key:"artist",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return t?(this.data.artist=t,this):this.data.artist}},{key:"album",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return t?(this.data.album=t,this):this.data.album}},{key:"setType",value:function(t){return this.type=t,this.audio.attr("type",this.type),this}},{key:"setSrc",value:function(t){return this.src=t,this.audio.attr("src",t),this}},{key:"listQueue",value:function(){var t=this.player.find(".queue");if(t.hasClass("open"))t.slideUp("fast",function(){t.removeClass("open")});else{var e=this.queue.list(),i=this.queue.currentIndex();t.html("");for(var a=0;a<e.length;a++)t.append("<span"+(a===i?' class="current"':"")+">"+e[a].title+" - "+e[a].artist+"</span>");t.slideDown("fast",function(){t.addClass("open")})}return this}},{key:"setPreviousHandler",value:function(t){return this.previousHandler=t,this}},{key:"setNextHandler",value:function(t){return this.nextHandler=t,this}}]),a}();_createClass=function(){function a(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,e,i){return e&&a(t.prototype,e),i&&a(t,i),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Queue=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];_classCallCheck(this,e),this.items=t,this.iterator=0}return _createClass(e,[{key:"previous",value:function(){return 0<this.iterator&&this.iterator--,this.current()}},{key:"next",value:function(){return this.iterator<this.items.length-1&&this.iterator++,this.current()}},{key:"current",value:function(){return this.items[this.iterator]}},{key:"currentIndex",value:function(){return this.iterator}},{key:"list",value:function(){return this.items}},{key:"add",value:function(t){return this.items.push(t),this}}]),e}();